<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HTMLスライドショー</title>
    <style>
        /* 既存のスタイルはそのまま */
        html, body {
            font-family: sans-serif;
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            box-sizing: border-box;
        }
        .slide-container {
            width: 100%;
            height: 100%;
            position: relative;
            box-sizing: border-box;
        }
        #slide-frame {
            width: 100%;
            height: 100%;
            border: none;
            box-sizing: border-box;
            display: block;
            overflow-y: auto; /* 縦方向のスクロールを可能に */
            overflow-x: hidden; /* 横方向のスクロールを無効に */
        }
        .controls {
            padding: 8px;
            text-align: center;
            background-color: rgba(240, 240, 240, 0.5); /* より透明に */
            width: auto; /* 幅を自動に設定 */
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            position: absolute;
            bottom: 10px; /* 上から下に変更 */
            left: 50%;
            transform: translateX(-50%); /* 中央揃え */
            z-index: 10;
            box-sizing: border-box;
            border-radius: 20px; /* 角を丸くする */
            backdrop-filter: blur(3px); /* 背景をぼかす効果（対応ブラウザのみ） */
            transition: opacity 0.3s;
            opacity: 0.7; /* 通常時は少し透明に */
        }
        .controls:hover {
            opacity: 1; /* ホバー時に完全に表示 */
        }
        .controls button {
            padding: 5px 12px;
            margin: 0 5px;
            cursor: pointer;
            font-size: 0.9em;
            border-radius: 15px;
            border: 1px solid #ccc;
            background-color: rgba(255, 255, 255, 0.7);
            transition: background-color 0.2s;
        }
        .controls button:hover {
            background-color: rgba(255, 255, 255, 0.9);
        }
        .controls span {
            margin: 0 10px;
            font-weight: bold;
            font-size: 0.9em;
        }

        /* --- サイドバーのスタイル --- */
        .sidebar-container {
            position: fixed;
            top: 0;
            left: -150px; /* 初期状態では非表示 */
            width: 150px; /* iframe の幅に合わせて調整 */
            height: 100%;
            background-color: #f8f8f8;
            border-right: 1px solid #ccc;
            box-shadow: 2px 0 5px rgba(0, 0, 0, 0.1);
            z-index: 20;
            transition: left 0.3s ease-in-out;
            overflow-y: auto;
        }
        .sidebar-container.open {
            left: 0;
        }
        .sidebar-toggle-btn {
            position: absolute;
            top: 10px;
            left: 10px;
            background-color: #ddd;
            border: none;
            padding: 8px 12px;
            cursor: pointer;
            border-radius: 5px;
            z-index: 21;
        }
        .sidebar-container.open .sidebar-toggle-btn {
            left: 120px; /* 幅に合わせて調整 */
        }
        .sidebar-title {
            padding: 10px;
            text-align: center;
            border-bottom: 1px solid #eee;
            font-weight: bold;
            font-size: 1.0em;
        }
        .sidebar-thumbnails {
            padding: 0;
            margin: 0;
            list-style: none;
        }
        .sidebar-thumbnails li {
            padding: 8px 10px;
            cursor: pointer;
            text-align: left; /* タイトルを左寄せ */
            border-bottom: 1px solid #eee;
            font-size: 0.9em;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        .sidebar-thumbnails li:last-child {
            border-bottom: none;
        }
        .sidebar-thumbnails li:hover {
            background-color: #f0f0f0;
        }
        .sidebar-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 19;
            display: none;
        }
        .sidebar-container.open ~ .sidebar-overlay {
            display: block;
        }

        /* --- ダイアログのスタイル --- */
        #slide-preview-dialog {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: white;
            border: 1px solid #ccc;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
            z-index: 30;
            padding: 20px;
            max-width: 80%;
            max-height: 80%;
            overflow: auto;
        }
        #slide-preview-dialog[open] {
            display: block;
        }
        #slide-preview-dialog:not([open]) {
            display: none;
        }
    </style>
</head>
<body>

<button id="sidebar-toggle-btn" class="sidebar-toggle-btn">≡</button>

<div class="sidebar-container">
    <div class="sidebar-title">スライド一覧</div>
    <ul id="sidebar-thumbnails" class="sidebar-thumbnails">
        </ul>
</div>

<div class="slide-container">
    <iframe id="slide-frame" src=""></iframe>
    <div class="controls">
        <button id="prevBtn">←</button>
        <span id="pageInfo"></span>
        <button id="nextBtn">→</button>
    </div>
</div>

<div class="sidebar-overlay"></div>

<dialog id="slide-preview-dialog"></dialog>

<script>
    // --- 設定箇所：表示したいHTMLファイル名をここに追加・編集してください ---
    // slide01.html から slide20.html までを設定
    const htmlFiles = [
        "slide01.html", "slide02.html", "slide03.html", "slide04.html", "slide05.html",
        "slide06.html", "slide07.html", "slide08.html",
        "slide09.html", "slide09-1.html", "slide09-2.html", "slide09-3.html", "slide09-4.html", "slide09-5.html", "slide09-6.html", "slide09-7.html", "slide09-8.html", "slide09-9.html",
        "slide10.html", "slide11.html",
        "slide12.html", "slide12-01.html", "slide12-02.html", "slide12-03.html", "slide12-04.html", "slide12-05.html", "slide12-06.html",
        "slide13.html", "slide13-01.html", "slide13-02.html", "slide13-03.html", "slide13-04.html", "slide13-05.html", "slide13-06.html",
        "slide14.html", "slide14-01.html", "slide14-02.html", "slide14-03.html", "slide14-04.html", "slide14-05.html", "slide14-06.html", "slide14-07.html", "slide14-08.html", "slide14-09.html",
        "slide15.html",
        "slide16.html", "slide17.html", "slide18.html", "slide19.html", "slide20.html"
    ];
    // --------------------------------------------------------------------

    let currentIndex = 0;
    const iframe = document.getElementById('slide-frame');
    const prevBtn = document.getElementById('prevBtn');
    const nextBtn = document.getElementById('nextBtn');
    const pageInfo = document.getElementById('pageInfo');
    const controls = document.querySelector('.controls');
    const sidebarContainer = document.querySelector('.sidebar-container');
    const sidebarToggleBtn = document.getElementById('sidebar-toggle-btn');
    const sidebarThumbnails = document.getElementById('sidebar-thumbnails');
    const sidebarOverlay = document.querySelector('.sidebar-overlay');
    const previewDialog = document.getElementById('slide-preview-dialog');

    // iframe内のドキュメントを横幅いっぱいに表示するための設定
    function setupIframeContent() {
        try {
            const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;

            // iframe読み込み完了後にスタイルを適用
            iframe.onload = function() {
                try {
                    const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;

                    // スタイルタグを作成して追加
                    const style = iframeDoc.createElement('style');
                    style.textContent = `
                        html, body {
                            width: 100% !important;
                            max-width: 100% !important;
                            margin: 0 !important;
                            padding: 0 !important;
                            overflow-x: hidden !important;
                            overflow-y: hidden !important; /* 念のため追加 */
                        }
                        body * {
                            max-width: 100% !important;
                            box-sizing: border-box !important;
                        }
                        img, video, table, pre, code {
                            max-width: 100% !important;
                            height: auto !important;
                        }
                    `;
                    iframeDoc.head.appendChild(style);
                } catch(e) {
                    console.log('iframe content style error:', e);
                }
            };
        } catch(e) {
            console.log('iframe access error:', e);
        }
    }

    function loadPage(index) {
        if (index >= 0 && index < htmlFiles.length) {
            currentIndex = index;
            iframe.src = htmlFiles[currentIndex];
            updateControls();
            setupIframeContent();
        }
    }

    function updateControls() {
        pageInfo.textContent = `${currentIndex + 1} / ${htmlFiles.length}`;
        prevBtn.disabled = currentIndex === 0;
        nextBtn.disabled = currentIndex === htmlFiles.length - 1;
    }

    // コントロールの自動非表示
    let controlsTimeout;
    function showControls() {
        controls.style.opacity = '0.7';
        clearTimeout(controlsTimeout);
        controlsTimeout = setTimeout(() => {
            controls.style.opacity = '0.3';
        }, 3000);
    }

    // マウス移動でコントロールを表示
    document.addEventListener('mousemove', showControls);

    prevBtn.addEventListener('click', () => {
        if (currentIndex > 0) {
            loadPage(currentIndex - 1);
        }
    });

    nextBtn.addEventListener('click', () => {
        if (currentIndex < htmlFiles.length - 1) {
            loadPage(currentIndex + 1);
        }
    });

    // キーボードでの操作
    document.addEventListener('keydown', (e) => {
        if (e.key === 'ArrowLeft' && currentIndex > 0) {
            loadPage(currentIndex - 1);
        } else if (e.key === 'ArrowRight' && currentIndex < htmlFiles.length - 1) {
            loadPage(currentIndex + 1);
        }
    });

    // サイドバーの表示/非表示切り替え
    sidebarToggleBtn.addEventListener('click', () => {
        sidebarContainer.classList.toggle('open');
    });

    sidebarOverlay.addEventListener('click', () => {
        sidebarContainer.classList.remove('open');
    });

    // サムネイル一覧を生成
    async function generateSidebar() {
        sidebarThumbnails.innerHTML = ''; // Clear previous content
        for (let i = 0; i < htmlFiles.length; i++) {
            const file = htmlFiles[i];
            const listItem = document.createElement('li');
            listItem.textContent = `スライド ${i + 1}`; // デフォルトのタイトル
            listItem.dataset.index = i; // インデックスを保存

            try {
                const response = await fetch(file);
                const htmlContent = await response.text();
                const doc = new DOMParser().parseFromString(htmlContent, 'text/html');
                const titleTag = doc.querySelector('title');
                const h1Tag = doc.querySelector('h1');

                if (titleTag) {
                    listItem.textContent = titleTag.textContent;
                } else if (h1Tag) {
                    listItem.textContent = h1Tag.textContent;
                }

                listItem.addEventListener('mouseover', async (event) => {
                    const index = parseInt(event.currentTarget.dataset.index);
                    const fileToPreview = htmlFiles[index];
                    try {
                        const previewResponse = await fetch(fileToPreview);
                        const previewContent = await previewResponse.text();
                        previewDialog.innerHTML = previewContent;
                        previewDialog.showModal();
                    } catch (error) {
                        console.error('Failed to fetch slide content:', error);
                        previewDialog.innerHTML = '<p>プレビューの読み込みに失敗しました。</p>';
                        previewDialog.showModal();
                    }
                });

                listItem.addEventListener('mouseout', () => {
                    previewDialog.close();
                });

                previewDialog.addEventListener('mouseleave', () => {
                    previewDialog.close();
                });

            } catch (error) {
                console.error('Failed to fetch HTML file:', error);
                listItem.textContent = `スライド ${i + 1} (読み込み失敗)`;
            }

            listItem.addEventListener('click', () => {
                loadPage(i);
            });

            sidebarThumbnails.appendChild(listItem);
        }
    }

    // 初期処理
    if (htmlFiles.length > 0) {
        loadPage(0);
        showControls(); // 初期表示時にコントロールを表示
        generateSidebar(); // サイドバーの生成
    } else {
        pageInfo.textContent = "表示するファイルがありません";
        prevBtn.disabled = true;
        nextBtn.disabled = true;
        iframe.src = 'about:blank'; // 何も表示しない
    }
</script>

</body>
</html>